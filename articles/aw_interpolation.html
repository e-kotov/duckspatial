<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Areal Interpolation • duckspatial</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Merriweather-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Areal Interpolation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">duckspatial</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0999</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/duckspatial.html">Get Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/spatial_joins.html">Spatial Joins</a></li>
    <li><a class="dropdown-item" href="../articles/aw_interpolation.html">Areal-Weighted Interpolation</a></li>
    <li><a class="dropdown-item" href="../articles/benchmark.html">Benchmarks</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Cidree/duckspatial" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Areal Interpolation</h1>
            
            <h4 data-toc-skip class="date">2025-12-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Cidree/duckspatial/blob/main/vignettes/aw_interpolation.Rmd" class="external-link"><code>vignettes/aw_interpolation.Rmd</code></a></small>
      <div class="d-none name"><code>aw_interpolation.Rmd</code></div>
    </div>

    
    
<p>This vignette demonstrates how to use
<code><a href="../reference/ddbs_interpolate_aw.html">ddbs_interpolate_aw()</a></code> to perform areal-weighted
interpolation. This technique is essential when you need to transfer
attributes from one set of polygons (source) to another incongruent set
of polygons (target) based on their area of overlap.</p>
<p><code><a href="../reference/ddbs_interpolate_aw.html">ddbs_interpolate_aw()</a></code> can be 9-30x faster than
<code><a href="https://r-spatial.github.io/sf/reference/interpolate_aw.html" class="external-link">sf::st_interpolate_aw</a></code> or <a href="https://chris-prener.github.io/areal/reference/aw_interpolate.html" class="external-link"><code>areal::aw_interpolate</code></a>
(see benchmarks in <a href="https://www.ekotov.pro/ducksf/" target="_blank" class="external-link"><code>{ducksf}</code></a> where prototype of
<code><a href="../reference/ddbs_interpolate_aw.html">ddbs_interpolate_aw()</a></code> was originally developed).</p>
<p><code>duckspatial</code> handles these heavy geometric calculations
efficiently using DuckDB. We will cover three scenarios:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Extensive vs. Intensive</strong>: Understanding the
difference between mass-preserving counts and densities.</li>
<li>
<strong>Fast Output</strong>: Returning a <code>tibble</code> (no
geometry) for maximum speed.</li>
<li>
<strong>Database Mode</strong>: Performing operations on persistent
database tables.</li>
</ol>
<div class="section level3">
<h3 id="setup-data">Setup Data<a class="anchor" aria-label="anchor" href="#setup-data"></a>
</h3>
<p>We will use the North Carolina dataset from the <code>sf</code>
package as our <strong>source</strong>, and create a generic grid as our
<strong>target</strong>.</p>
<p><em>Note: We project the data to Albers Equal Area (EPSG:5070)
because accurate interpolation requires an equal-area
projection.</em></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cidree.github.io/duckspatial/">duckspatial</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1. Load Source Data (NC Counties)</span></span>
<span><span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"shape/nc.shp"</span>, package <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Transform to projected CRS (Albers) for accurate area calculations</span></span>
<span><span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">nc</span>, <span class="fl">5070</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Create a Target Grid</span></span>
<span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html" class="external-link">st_make_grid</a></span><span class="op">(</span><span class="va">nc</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. Create Unique IDs (Required for interpolation)</span></span>
<span><span class="va">nc</span><span class="op">$</span><span class="va">source_id</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span></span>
<span><span class="va">grid</span><span class="op">$</span><span class="va">target_id</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="extensive-vs--intensive-interpolation">1) Extensive vs. Intensive Interpolation<a class="anchor" aria-label="anchor" href="#extensive-vs--intensive-interpolation"></a>
</h2>
<p>Areal interpolation works differently depending on the nature of the
data.</p>
<div class="section level3">
<h3 id="case-a-extensive-variables-counts">Case A: Extensive Variables (Counts)<a class="anchor" aria-label="anchor" href="#case-a-extensive-variables-counts"></a>
</h3>
<p>Variables like population counts or total births (<code>BIR74</code>)
are <strong>spatially extensive</strong>. If a source polygon is split
in half, the count should also be split in half. We use
<code>weight = "total"</code> to ensure strict mass preservation
relative to the source.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Interpolate Total Births (Extensive)</span></span>
<span><span class="va">res_extensive</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ddbs_interpolate_aw.html">ddbs_interpolate_aw</a></span><span class="op">(</span></span>
<span>  target <span class="op">=</span> <span class="va">grid</span>,</span>
<span>  source <span class="op">=</span> <span class="va">nc</span>,</span>
<span>  tid <span class="op">=</span> <span class="st">"target_id"</span>,</span>
<span>  sid <span class="op">=</span> <span class="st">"source_id"</span>,</span>
<span>  extensive <span class="op">=</span> <span class="st">"BIR74"</span>,</span>
<span>  weight <span class="op">=</span> <span class="st">"total"</span>,</span>
<span>  output <span class="op">=</span> <span class="st">"sf"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Query successful</span></span></code></pre></div>
<p><strong>Verification:</strong> The total sum of births in the result
should match the original data (mass preservation).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">orig_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">nc</span><span class="op">$</span><span class="va">BIR74</span><span class="op">)</span></span>
<span><span class="va">new_sum</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">res_extensive</span><span class="op">$</span><span class="va">BIR74</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Original: %s | Interpolated: %s"</span>, <span class="va">orig_sum</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">new_sum</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Original: 329962 | Interpolated: 329962"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="case-b-intensive-variables-densitiesratios">Case B: Intensive Variables (Densities/Ratios)<a class="anchor" aria-label="anchor" href="#case-b-intensive-variables-densitiesratios"></a>
</h3>
<p>Variables like population density or infection rates are
<strong>spatially intensive</strong>. If a source polygon is split, the
density remains the same in both pieces. <code>duckspatial</code>
handles this by calculating the area-weighted average.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Interpolate 'BIR74' treating it as an intensive variable (e.g. density assumption)</span></span>
<span><span class="va">res_intensive</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ddbs_interpolate_aw.html">ddbs_interpolate_aw</a></span><span class="op">(</span></span>
<span>  target <span class="op">=</span> <span class="va">grid</span>,</span>
<span>  source <span class="op">=</span> <span class="va">nc</span>,</span>
<span>  tid <span class="op">=</span> <span class="st">"target_id"</span>,</span>
<span>  sid <span class="op">=</span> <span class="st">"source_id"</span>,</span>
<span>  intensive <span class="op">=</span> <span class="st">"BIR74"</span>, <span class="co"># Treated as density here</span></span>
<span>  weight <span class="op">=</span> <span class="st">"sum"</span>,      <span class="co"># Standard behavior for intensive vars</span></span>
<span>  output <span class="op">=</span> <span class="st">"sf"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Query successful</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visual-comparison">Visual Comparison<a class="anchor" aria-label="anchor" href="#visual-comparison"></a>
</h3>
<p>Notice the difference in patterns. Extensive interpolation
accumulates values based on how much “stuff” falls into a grid cell,
while intensive interpolation smoothes the values based on overlap.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Combine for plotting</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">res_extensive</span><span class="op">[</span>, <span class="st">"BIR74"</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Extensive_Count"</span></span>
<span><span class="va">plot_data</span><span class="op">$</span><span class="va">Intensive_Value</span> <span class="op">&lt;-</span> <span class="va">res_intensive</span><span class="op">$</span><span class="va">BIR74</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Extensive_Count"</span>, <span class="st">"Intensive_Value"</span><span class="op">)</span><span class="op">]</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"Interpolation Methods Comparison"</span>,</span>
<span>     border <span class="op">=</span> <span class="st">"grey90"</span>,</span>
<span>     key.pos <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p><img src="aw_interpolation_files/figure-html/unnamed-chunk-5-1.png" class="r-plt" alt="" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="high-performance-output-as-tibble">2) High Performance: Output as Tibble<a class="anchor" aria-label="anchor" href="#high-performance-output-as-tibble"></a>
</h2>
<p>If you are working with massive datasets, constructing the geometry
for the result <code>sf</code> object can be slow. If you only need the
interpolated numbers, set <code>output = "tibble"</code>. This skips the
geometry construction step and is significantly faster.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Return a standard data.frame/tibble without geometry</span></span>
<span><span class="va">res_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ddbs_interpolate_aw.html">ddbs_interpolate_aw</a></span><span class="op">(</span></span>
<span>  target <span class="op">=</span> <span class="va">grid</span>,</span>
<span>  source <span class="op">=</span> <span class="va">nc</span>,</span>
<span>  tid <span class="op">=</span> <span class="st">"target_id"</span>,</span>
<span>  sid <span class="op">=</span> <span class="st">"source_id"</span>,</span>
<span>  extensive <span class="op">=</span> <span class="st">"BIR74"</span>,</span>
<span>  output <span class="op">=</span> <span class="st">"tibble"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Query successful</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res_tbl</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   target_id crs_duckspatial BIR74</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>         1 EPSG:5070       <span style="text-decoration: underline;">1</span>168.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>         2 EPSG:5070        379.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>         6 EPSG:5070        753.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>         7 EPSG:5070       <span style="text-decoration: underline;">5</span>731.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>         8 EPSG:5070       <span style="text-decoration: underline;">8</span>000.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>        11 EPSG:5070       <span style="text-decoration: underline;">1</span>417.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="database-mode-large-data-workflows">3) Database Mode: Large Data Workflows<a class="anchor" aria-label="anchor" href="#database-mode-large-data-workflows"></a>
</h2>
<p>For datasets larger than memory, or for persistent pipelines, you can
perform the interpolation directly inside the DuckDB database without
pulling data into R until the end.</p>
<p>First, let’s establish a connection and load our spatial layers into
tables.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create connection</span></span>
<span><span class="va">conn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ddbs_create_conn.html">ddbs_create_conn</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Write layers to DuckDB</span></span>
<span><span class="fu"><a href="../reference/ddbs_write_vector.html">ddbs_write_vector</a></span><span class="op">(</span><span class="va">conn</span>, <span class="va">nc</span>, <span class="st">"nc_table"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Table &lt;nc_table&gt; dropped</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Table nc_table successfully imported</span></span>
<span><span class="fu"><a href="../reference/ddbs_write_vector.html">ddbs_write_vector</a></span><span class="op">(</span><span class="va">conn</span>, <span class="va">grid</span>, <span class="st">"grid_table"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Table &lt;grid_table&gt; dropped</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Table grid_table successfully imported</span></span></code></pre></div>
<p>Now we run the interpolation by referencing the table names. We can
also use the <code>name</code> argument to save the result directly to a
new table instead of returning it to R.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run interpolation and save to new table 'nc_grid_births'</span></span>
<span><span class="fu"><a href="../reference/ddbs_interpolate_aw.html">ddbs_interpolate_aw</a></span><span class="op">(</span></span>
<span>  conn <span class="op">=</span> <span class="va">conn</span>,</span>
<span>  target <span class="op">=</span> <span class="st">"grid_table"</span>,</span>
<span>  source <span class="op">=</span> <span class="st">"nc_table"</span>,</span>
<span>  tid <span class="op">=</span> <span class="st">"target_id"</span>,</span>
<span>  sid <span class="op">=</span> <span class="st">"source_id"</span>,</span>
<span>  extensive <span class="op">=</span> <span class="st">"BIR74"</span>,</span>
<span>  weight <span class="op">=</span> <span class="st">"total"</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"nc_grid_births"</span>, <span class="co"># &lt;--- Writes to DB</span></span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Table &lt;nc_grid_births&gt; dropped</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Query successful</span></span>
<span></span>
<span><span class="co"># Verify the table was created</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbListTables.html" class="external-link">dbListTables</a></span><span class="op">(</span><span class="va">conn</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "grid_table"     "nc_grid_births" "nc_table"</span></span></code></pre></div>
<p>We can now query this table or read it back later.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read the result back from the database</span></span>
<span><span class="va">final_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ddbs_read_vector.html">ddbs_read_vector</a></span><span class="op">(</span><span class="va">conn</span>, <span class="st">"nc_grid_births"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> table nc_grid_births successfully imported.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">final_sf</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 2 fields</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 1054293 ymin: 1348021 xmax: 1677656 ymax: 1484503</span></span>
<span><span class="co">#&gt; Projected CRS: NAD83 / Conus Albers</span></span>
<span><span class="co">#&gt;   target_id     BIR74                              x</span></span>
<span><span class="co">#&gt; 1         1 1168.3093 POLYGON ((1054293 1348021, ...</span></span>
<span><span class="co">#&gt; 2         2  378.5281 POLYGON ((1132214 1348021, ...</span></span>
<span><span class="co">#&gt; 3         6  752.9156 POLYGON ((1443895 1348021, ...</span></span>
<span><span class="co">#&gt; 4         7 5731.0103 POLYGON ((1521815 1348021, ...</span></span>
<span><span class="co">#&gt; 5         8 7999.6957 POLYGON ((1599735 1348021, ...</span></span>
<span><span class="co">#&gt; 6        11 1416.5579 POLYGON ((1054293 1416262, ...</span></span></code></pre></div>
<p>If we only wanted the database table, without the geometry, we could
do:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ddbs_interpolate_aw.html">ddbs_interpolate_aw</a></span><span class="op">(</span></span>
<span>  conn <span class="op">=</span> <span class="va">conn</span>,</span>
<span>  target <span class="op">=</span> <span class="st">"grid_table"</span>,</span>
<span>  source <span class="op">=</span> <span class="st">"nc_table"</span>,</span>
<span>  tid <span class="op">=</span> <span class="st">"target_id"</span>,</span>
<span>  sid <span class="op">=</span> <span class="st">"source_id"</span>,</span>
<span>  extensive <span class="op">=</span> <span class="st">"BIR74"</span>,</span>
<span>  weight <span class="op">=</span> <span class="st">"total"</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"nc_grid_births"</span>, <span class="co"># &lt;--- Writes to DB</span></span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  output <span class="op">=</span> <span class="st">"tibble"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Table &lt;nc_grid_births&gt; dropped</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Query successful</span></span></code></pre></div>
<p>And preview this table directly in the database:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">conn</span>, <span class="st">"SELECT * FROM nc_grid_births LIMIT 5"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   target_id crs_duckspatial     BIR74</span></span>
<span><span class="co">#&gt; 1         1       EPSG:5070 1168.3093</span></span>
<span><span class="co">#&gt; 2         2       EPSG:5070  378.5281</span></span>
<span><span class="co">#&gt; 3         6       EPSG:5070  752.9156</span></span>
<span><span class="co">#&gt; 4         7       EPSG:5070 5731.0103</span></span>
<span><span class="co">#&gt; 5         8       EPSG:5070 7999.6957</span></span></code></pre></div>
<div class="section level3">
<h3 id="cleanup">Cleanup<a class="anchor" aria-label="anchor" href="#cleanup"></a>
</h3>
<p>Always close the connection when finished.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu">dbDisconnect</span><span class="op">(</span><span class="va">conn</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://adrian-cidre.com/" class="external-link">Adrián Cidre González</a>, Rafael H. M. Pereira, <a href="https://www.ekotov.pro/" class="external-link">Egor Kotov</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
